Create table orders (
    rdbms_id INT Not null,
    country_name VARCHAR(1000) not null,
    date_local DATE not null,
    vendor_id INT Not null,
    customer_id INT not null,
    gmv_local DECIMAL(10, 2) Null,
    is_voucher_used VARCHAR(1000) not null,
    is_successful_order VARCHAR(1000) not null);

LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/orders_db.csv'
INTO TABLE orders
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 ROWS;

SHOW VARIABLES LIKE "secure_file_priv";

SELECT * FROM orders;

CREATE TABLE vendors_with_duplicates (
    id INT NOT NULL,
    rdbms_id INT NOT NULL,
    country_name VARCHAR(1000) NOT NULL,
    vendor_name VARCHAR (1000) NOT NULL
);

CREATE TABLE vendors (
    id INT NOT NULL,
    rdbms_id INT NOT NULL,
    country_name VARCHAR(1000) NOT NULL,
    vendor_name VARCHAR (1000) NOT NULL
);

DROP TABLE vendors;


LOAD DATA INFILE 'C:/ProgramData/MySQL/MySQL Server 5.7/Uploads/vendors_db.csv'
INTO TABLE vendors_with_duplicates
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 ROWS;

SELECT * FROM vendors_with_duplicates;

SELECT COUNT(DISTINCT id) FROM vendors;

INSERT INTO vendors
SELECT distinct id, rdbms_id, country_name, vendor_name 
FROM vendors_with_duplicates;

SELECT * FROM vendors;


select * from vendors;

select * from orders;

--- Q1 List all successful orders that were made in Taiwan
--- Expected answer: Select * for results to display all fields in the original table and sort by highest to lowest gmv_local

select * from orders 
WHERE is_successful_order 
like '%TRUE%'
order by gmv_local desc
;

--- Q2 Find the Total GMV by country
--- Expected answer: Display only Country and Total GMV, sort by GMV

select country_name as Country, gmv_local as Total_GMV
from orders
group by country_name
order by gmv_local
;

--- Q3 Find the top active vendor by GMV in each country
--- Expected answer: Display only country, vendor name and total GMV, sort by country first then vendor GMV

select orders.country_name as Country, vendors.vendor_name as Vendor, orders.gmv_local as GMV
from orders
left join vendors 
on orders.vendor_id = vendors.id
group by vendors.vendor_name
order by Country, GMV;

--- Q4 Find the top 2 vendors per country, in each year available in the dataset
--- Expected answer: Display only 2 vendors per country, year, country, and total GMV, sorted by country, then vendor GMV 

select vendors.vendor_name, orders.date_local, orders.country_name, orders.gmv_local
from orders
right join vendors
on orders.vendor_id = vendors.id
group by year(orders.date_local), vendors.vendor_name
;


